#include <REG52.H>    
#include <INTRINS.H>    
//本例采用90C51, 晶振为11.0592MHZ    
//关于如何编制音乐代码, 其实十分简单,各位可以看以下代码.    
//频率常数即音乐术语中的音调,而节拍常数即音乐术语中的多少拍;    
//所以拿出谱子, 试探编吧!

sbit Beep =  P1^5 ; 
   
unsigned int n=0;  //n为节拍常数变量    
unsigned int code music_tab[] ={
	//原始c文件均为16进制，且在烧录时记得用stc90，否则data太大无法写入内存，造成没有播放完直接从头开始放
	/*0x5e,0x80,0x4f,0x40,0x46,0x40,0x5e,0x80,0x4f,0x40,0x46,0x40,0x3e,0x80,0x34,0x40,0x2f,0x40,0x46,0x80,0x4f,0x40,0x53,0x40,0x5e,0xc0,0x69,0x40,0x4f,0x80,0x53,0x60,0x46,0x20,0x5e,0xff,0x5e,0xff,
	0x5e,0x20,0x3e,0x20,0x46,0x20,0x3e,0x40,0x4f,0x40,0x53,0x40,0x4f,0x20,0x46,0x40,0x53,0x80,
	0x5e,0x20,0x3e,0x20,0x46,0x20,0x3e,0x40,0x4f,0x40,0x53,0x40,0x4f,0x20,0x46,0x40,0x4f,0x40,0x53,0x40,0x5e,0x80,0x4f,0x20,0x53,0x80,0x53,0x20,0x4f,0x20,0x46,0x20,0x5e,0xff,0x5e,0xff,
	0x4f,0x40,0x27,0x20,0x29,0x40,0x27,0x40,0x34,0x40,0x4f,0x20,0x2f,0x20,0x34,0xa0,0x4f,0x40,0x27,0x20,0x29,0x40,0x27,0x40,0x34,0x40,0x3e,0x20,0x2f,0x20,0x2f,0x20,0x29,0x20,0x34,0xc0,
	0x34,0x20,0x34,0x20,0x3b,0x20,0x3b,0x20,0x3e,0x20,0x3e,0x20,0x4f,0x40,0x5e,0x20,0x46,0x40,0x4f,0x80,0x4f,0x20,0x34,0x20,0x34,0x20,0x3b,0x20,0x3b,0x20,0x3e,0x20,0x3e,0x20,0x46,0x40,0x4f,0x20,0x46,0x60,
	0x4f,0x40,0x27,0x20,0x29,0x40,0x27,0x40,0x34,0x40,0x4f,0x20,0x2f,0x20,0x34,0xa0,0x4f,0x40,0x27,0x20,0x29,0x40,0x27,0x40,0x23,0x20,0x34,0x40,0x23,0x80,0x1f,0xc0,
	0x34,0x80,0x3b,0x20,0x3e,0x20,0x3b,0x20,0x34,0x60,0x4f,0x20,0x34,0x40,0x2f,0x20,0x29,0x20,0x27,0x20,0x29,0x20,0x34,0x80,0x3e,0x20,0x46,0xff,
	0x69,0x40,0x5e,0x40,0x4f,0x40,0x46,0x20,0x69,0x20,0x69,0x40,0x5e,0x40,0x4f,0x20,0x46,0x20,0x69,0x40,0x3e,0x40,0x46,0x40,0x46,0x40,0x4f,0x20,0x53,0x20,0x53,0x40,0x4f,0x40,0x53,0x40,0x69,0x40,
	0x69,0x40,0x5e,0x40,0x4f,0x40,0x46,0x20,0x69,0x20,0x69,0x40,0x5e,0x40,0x4f,0x20,0x46,0x20,0x69,0x40,0x3e,0x40,0x46,0x40,0x46,0x40,0x4f,0x20,0x53,0x20,0x53,0x40,0x4f,0x80,
	0x34,0x20,0x2f,0x20,0x34,0x60,0x3e,0x20,0x34,0x60,0x4f,0x20,0x4f,0x20,0x46,0x20,0x3e,0x20,0x2f,0x20,0x34,0x40,0x3e,0x20,0x34,0x20,0x34,0x60,0x3e,0x20,0x34,0xff,
	0x34,0x20,0x2f,0x20,0x34,0x60,0x3e,0x20,0x34,0x60,0x4f,0x20,0x4f,0x20,0x46,0x20,0x3e,0x20,0x2f,0x20,0x34,0x40,0x3e,0x20,0x34,0x20,0x34,0x60,0x27,0x20,0x34,0xff,0x34,0xff,
	0x69,0x40,0x5e,0x40,0x4f,0x40,0x46,0x20,0x69,0x20,0x69,0x40,0x5e,0x40,0x4f,0x20,0x46,0x20,0x69,0x40,0x3e,0x40,0x46,0x40,0x46,0x40,0x4f,0x20,0x53,0x20,0x53,0x40,0x4f,0x40,0x53,0x40,0x69,0x40,
	0x69,0x40,0x5e,0x40,0x4f,0x40,0x46,0x20,0x69,0x20,0x69,0x40,0x5e,0x40,0x4f,0x20,0x46,0x20,0x69,0x40,0x3e,0x40,0x46,0x40,0x46,0x40,0x4f,0x20,0x53,0x20,0x53,0x40,0x4f,0x80,
	0x4f,0x40,0x27,0x20,0x29,0x40,0x27,0x40,0x34,0x40,0x4f,0x20,0x2f,0x20,0x34,0xa0,0x4f,0x40,0x27,0x20,0x29,0x40,0x27,0x40,0x34,0x40,0x3e,0x20,0x2f,0x20,0x2f,0x20,0x29,0x20,0x34,0xc0,
	0x34,0x20,0x34,0x20,0x3b,0x20,0x3b,0x20,0x3e,0x20,0x3e,0x20,0x4f,0x40,0x5e,0x20,0x46,0x40,0x4f,0x80,0x4f,0x20,0x34,0x20,0x34,0x20,0x3b,0x20,0x3b,0x20,0x3e,0x20,0x3e,0x20,0x46,0x40,0x4f,0x20,0x46,0x80,
	0x4f,0x40,0x27,0x20,0x29,0x40,0x27,0x40,0x34,0x40,0x4f,0x20,0x2f,0x20,0x34,0xa0,0x4f,0x40,0x27,0x20,0x29,0x40,0x27,0x40,0x23,0x20,0x34,0x40,0x23,0x80,0x1f,0xc0,
	0x34,0x60,0x3b,0x20,0x3e,0x20,0x3b,0x20,0x34,0x60,0x4f,0x20,0x34,0x40,0x2f,0x20,0x29,0x20,0x27,0x20,0x29,0x20,0x34,0x80,0x3e,0x20,0x46,0xff,
	0x5e,0x80,0x4f,0x40,0x46,0x40,0x5e,0x80,0x4f,0x40,0x46,0x40,0x3e,0x80,0x34,0x40,0x2f,0x40,0x46,0x80,0x4f,0x40,0x53,0x40,0x5e,0xc0,0x69,0x40,0x4f,0x80,0x53,0x60,0x46,0x20,0x5e,0xff,0x5e,0xff,0x5e,0xff,
	0x00*/
	//以下是十进制数字，因为位数的原因可以展比两位16进制开更多，而且相比十六进制更省占用空间
	94,128,79,64,70,64,94,128,79,64,70,64,62,128,52,64,47,64,70,128,79,64,83,64,94,192,105,64,79,128,83,96,70,32,94,480,
	94,32,62,32,70,32,62,64,79,64,83,64,79,32,70,64,83,128,
	94,32,62,32,70,32,62,64,79,64,83,64,79,32,70,64,79,32,83,64,94,192,79,32,83,128,83,32,79,32,70,32,94,257,
	79,64,39,32,41,64,39,64,52,64,79,32,47,32,52,160,79,64,39,32,41,64,39,64,52,64,62,32,47,32,47,32,41,32,52,192,
	52,32,52,32,59,32,59,32,62,32,62,32,79,64,94,32,70,64,79,128,79,32,52,32,52,32,59,32,59,32,62,32,62,32,70,64,79,32,70,128,
	79,64,39,32,41,64,39,64,52,64,79,32,47,32,52,160,79,64,39,32,41,64,39,64,35,32,52,64,35,128,31,192,
	52,128,59,32,62,32,59,32,52,96,79,32,52,64,47,32,41,32,39,32,41,32,52,128,62,32,70,256,
	105,64,94,64,79,64,70,32,105,32,105,64,94,64,79,32,70,32,105,64,62,64,70,64,70,64,79,32,83,32,83,64,79,64,83,64,105,64,
	105,64,94,64,79,64,70,32,105,32,105,64,94,64,79,32,70,32,105,64,62,64,70,64,70,64,79,32,83,32,83,64,79,128,
	52,32,47,32,52,96,62,32,52,96,79,32,79,32,70,32,62,32,47,32,52,64,62,32,52,32,52,96,62,32,52,288,
	52,32,47,32,52,96,62,32,52,96,79,32,79,32,70,32,62,32,47,32,52,64,62,32,52,32,52,96,39,32,52,288,
	94,128,79,64,70,64,94,128,79,64,70,64,62,128,52,64,47,64,70,128,79,64,83,64,94,192,105,64,79,128,83,96,70,32,94,256,94,256,
	0
};
/*unsigned int code music_tab[] = {
	94,128,79,64,70,64,94,128,79,64,70,64,62,128,52,64,47,64,70,128,79,64,83,64,94,192,105,64,79,128,83,96,70,32,94,256,94,4000,
	0
};*/
   
void int0()  interrupt 1   //采用中断0 控制节拍    
{  TH0=0xd8;   
   TL0=0xef;   
   n--;   
}   
   
void delay (unsigned int m)   //控制频率延时    
{   
 unsigned i=3*m;   
 while(--i);   
}   
   
void delayms(unsigned int a)  //豪秒延时子程序    
{   
  while(--a);                  //采用while(--a) 不要采用while(a--); 各位可编译一下看看汇编结果就知道了!    
}   
   
void main()   
{ unsigned int p,m;   //m为频率常数变量    
  unsigned int i=0;   
  TMOD&=0x0f;   
  TMOD|=0x01;   
  TH0=0xd8;TL0=0xef;   
  IE=0x82;   
play:   
   while(1)   
    {   
    a: p=music_tab[i];   
       if(p==0x00)       { i=0, delayms(1000); goto play;}     //如果碰到结束符,延时1秒,回到开始再来一遍    
       else if(p==0x02)  { i=i+1;delayms(100),TR0=0; goto a;}  //若碰到休止符,延时100ms,继续取下一音符    
            else         {m=music_tab[i++], n=music_tab[i++];}  //取频率常数 和 节拍常数    
             TR0=1;                                             //开定时器1    
           while(n!=0) Beep=~Beep,delay(m);                         //等待节拍完成, 通过P1口输出音频(可多声道哦!)    
       TR0=0;                                             //关定时器1    
    }   
}  